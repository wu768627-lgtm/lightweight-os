# LightweightOS 测试计划

## 概述

本文档描述了如何测试 LightweightOS 操作系统的各个功能模块。由于当前环境限制，无法直接运行测试，因此提供详细的测试步骤和预期结果，以便在合适的环境中进行测试。

## 环境要求

### 构建环境
- GCC 编译器 (支持 i386 架构)
- GNU Make
- NASM 汇编器
- LD 链接器
- OBJCOPY 工具

### 运行环境
- QEMU 虚拟机 (或其他 x86 虚拟机)
- 至少 32MB RAM
- 至少 100MB 硬盘空间

## 构建测试

### 1. 构建内核
```bash
cd lightweight-os
make
```

预期结果：
- 应该成功生成 [kernel.bin](file:///f:/app2/Desktop/kg/lightweight-os/build/kernel.bin) 文件
- 应该成功生成 [boot.bin](file:///f:/app2/Desktop/kg/lightweight-os/build/boot.bin) 文件
- 应该成功生成 [lightweightos.img](file:///f:/app2/Desktop/kg/lightweight-os/build/lightweightos.img) 系统镜像

### 2. 构建用户空间程序
```bash
make userland
```

预期结果：
- 应该成功生成用户空间程序二进制文件

## 功能测试

### 1. 启动测试
1. 使用 QEMU 运行系统：
   ```bash
   make run
   ```
2. 预期结果：
   - 系统应该成功启动
   - 显示 "LightweightOS Kernel Loading..." 消息
   - 显示各个子系统初始化成功的消息
   - 最终进入用户空间初始化程序

### 2. 内存管理测试
1. 在内核初始化过程中检查内存管理输出
2. 预期结果：
   - 显示 "Memory management initialized."
   - 显示内存信息

### 3. 进程管理测试
1. 检查进程管理初始化消息
2. 预期结果：
   - 显示 "Process management initialized."
   - 成功启动 init 进程

### 4. 文件系统测试
1. 在系统启动后尝试文件操作
2. 预期结果：
   - 能够挂载 FAT 文件系统
   - 能够创建、读取、写入文件
   - 能够创建和浏览目录

### 5. 网络测试
1. 检查网络子系统初始化
2. 预期结果：
   - 显示 "Network subsystem initialized."
   - 成功初始化 TCP/IP 协议栈

### 6. 设备驱动测试
1. 检查键盘驱动初始化
2. 预期结果：
   - 显示 "PS/2 Keyboard initialized"
   - 能够接收键盘输入

### 7. 用户空间应用测试
1. 运行文本编辑器程序
2. 预期结果：
   - 成功启动文本编辑器
   - 能够编辑文本
   - 能够保存和加载文件

## 性能测试

### 1. 启动时间测试
1. 测量从系统启动到用户空间程序运行的时间
2. 预期结果：
   - 启动时间应小于 5 秒

### 2. 内存使用测试
1. 检查系统内存占用
2. 预期结果：
   - 内核内存占用应小于 32MB

### 3. 进程切换测试
1. 创建多个进程并测试切换时间
2. 预期结果：
   - 进程切换时间应小于 100 纳秒

## 安全测试

### 1. 权限控制测试
1. 尝试以非特权用户身份执行特权操作
2. 预期结果：
   - 应该拒绝访问并记录审计日志

### 2. 文件访问控制测试
1. 尝试访问受限文件
2. 预期结果：
   - 应该根据 SELinux 策略拒绝或允许访问

### 3. 网络访问控制测试
1. 尝试连接受限网络地址
2. 预期结果：
   - 应该根据安全策略拒绝或允许连接

## 压力测试

### 1. 内存压力测试
1. 分配大量内存并测试系统响应
2. 预期结果：
   - 系统应该稳定运行
   - 内存管理应该正常工作

### 2. CPU 压力测试
1. 运行 CPU 密集型任务
2. 预期结果：
   - 系统应该正常调度任务
   - 不应该出现死锁或崩溃

### 3. I/O 压力测试
1. 执行大量文件读写操作
2. 预期结果：
   - 文件系统应该正常工作
   - 不应该出现数据损坏

## 测试工具

### 1. 性能监控工具
- 使用内置的性能分析工具监控系统性能
- 检查性能统计输出

### 2. 调试工具
- 使用 QEMU 的调试功能
- 检查内核日志输出

## 故障排除

### 常见问题
1. 系统无法启动
   - 检查引导扇区是否正确构建
   - 检查内核是否正确加载

2. 内存不足
   - 检查内存管理实现
   - 优化内存分配策略

3. 设备无法识别
   - 检查设备驱动程序
   - 验证硬件接口实现

### 调试步骤
1. 启用详细日志输出
2. 使用调试器逐步执行
3. 检查系统状态和寄存器值
4. 分析错误日志

## 测试报告

测试完成后，应生成包含以下信息的测试报告：
1. 测试环境描述
2. 测试用例执行结果
3. 性能基准数据
4. 发现的问题和缺陷
5. 改进建议